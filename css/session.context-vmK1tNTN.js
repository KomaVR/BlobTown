import{r as p,C as E}from"./components-B4muXIau.js";import{j as y,K as T,i as h,L as N,N as k,O as C,V as P}from"./client-DJ4wINi5.js";function M(){return y({async mutationFn(t){try{return T(h,N),await k(h,t.email,t.password)}catch(e){throw console.error(e,"[login] Failed to sign in with email/password."),e}}})}var j=t=>t.trim().length!==0&&!Number.isNaN(Number(t)),F=class extends Error{constructor(t,e){super(e+""),this.status=t,this.value=e}},I=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,L=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,A=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,O=(t,e)=>(n,{query:i,params:d,body:r,...u}={})=>{var f;d&&Object.entries(d).forEach(([l,s])=>{n=n.replace(`:${l}`,s)});let w=(f=u.headers)==null?void 0:f["Content-Type"];if(!w||w==="application/json")try{r=JSON.stringify(r)}catch{}let S=globalThis.fetch,v=i?`?${new URLSearchParams(i).toString()}`:"",m=()=>{var l;return S(t+n+v,{...u,method:((l=u.method)==null?void 0:l.toUpperCase())||"GET",headers:r?{"content-type":"application/json",...u.headers}:u.headers,body:r}).then(async s=>{var b;let o;switch((b=s.headers.get("Content-Type"))==null?void 0:b.split(";")[0]){case"application/json":o=await s.json();break;case"application/octet-stream":o=await s.arrayBuffer();break;case"multipart/form-data":let x=await s.formData();o={},x.forEach((a,c)=>{o[c]=a});break;default:o=await s.text().then(a=>{if(j(a))return+a;if(a==="true")return!0;if(a==="false")return!1;if(!a)return a;let c=a.replace(/"/g,"");if(I.test(c)||L.test(c)||A.test(c)){let g=new Date(c);if(!Number.isNaN(g.getTime()))return g}return a})}return s.status>300?{data:null,status:s.status,headers:s.headers,retry:m,error:new F(s.status,o)}:{data:o,error:null,status:s.status,headers:s.headers,retry:m}})};return m()};const U=O("/api");function V(){return y({async mutationFn(t){try{T(h,N);const{data:e}=await U("/sessions",{method:"POST",body:{deviceId:"Unknown"},headers:{Authorization:`Bearer ${t.token}`}});if(!e)throw new Error("Unable to create VR session.");return await C(h,e.authToken)}catch(e){throw console.error(e,"[login] Failed to sign in with email/password."),e}}})}const D=p.createContext({status:"PENDING",currentUserId:void 0,accessToken:void 0,device:P.client?"headset":"browser"}),W=()=>p.useContext(D);function Z(){const[t]=E(),e=M(),n=V(),i=t.get("blobt"),d=t.get("blobu"),r=t.get("blobp");return p.useEffect(()=>{i&&n.mutate({token:i}),d&&r&&e.mutate({email:`${d}@blobtown.com`,password:r})},[n.mutate,e.mutate,i,d,r]),null}export{Z as S,D as a,M as b,U as c,W as u};
