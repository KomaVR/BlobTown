var R=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var a=(i,t,e)=>(R(i,t,"read from private field"),e?e.call(i):t.get(i)),y=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)},l=(i,t,e,s)=>(R(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e);var d=(i,t,e)=>(R(i,t,"access private method"),e);import{R as K,C as P,b as O,B as j,E as H,n as Q,t as T,F as U,G as k,H as L,I as $,J as B}from"./client-DJ4wINi5.js";import{r as E,x as I}from"./components-B4muXIau.js";import{L as z}from"./loading-indicator-BTBG-Unk.js";var v,g,u,n,C,m,c,f,M,Z=(M=class extends K{constructor(t){super();y(this,c);y(this,v,void 0);y(this,g,void 0);y(this,u,void 0);y(this,n,void 0);y(this,C,void 0);y(this,m,void 0);l(this,m,!1),l(this,C,t.defaultOptions),this.setOptions(t.options),this.observers=[],l(this,u,t.cache),this.queryKey=t.queryKey,this.queryHash=t.queryHash,l(this,v,t.state||W(this.options)),this.state=a(this,v),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=a(this,n))==null?void 0:t.promise}setOptions(t){this.options={...a(this,C),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&a(this,u).remove(this)}setData(t,e){const s=P(this.state.data,t,this.options);return d(this,c,f).call(this,{data:s,type:"success",dataUpdatedAt:e==null?void 0:e.updatedAt,manual:e==null?void 0:e.manual}),s}setState(t,e){d(this,c,f).call(this,{type:"setState",state:t,setStateOptions:e})}cancel(t){var s,h;const e=(s=a(this,n))==null?void 0:s.promise;return(h=a(this,n))==null||h.cancel(t),e?e.then(O).catch(O):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(a(this,v))}isActive(){return this.observers.some(t=>t.options.enabled!==!1)}isDisabled(){return this.getObserversCount()>0&&!this.isActive()}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(t=0){return this.state.isInvalidated||this.state.data===void 0||!j(this.state.dataUpdatedAt,t)}onFocus(){var e;const t=this.observers.find(s=>s.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(e=a(this,n))==null||e.continue()}onOnline(){var e;const t=this.observers.find(s=>s.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(e=a(this,n))==null||e.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),a(this,u).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(e=>e!==t),this.observers.length||(a(this,n)&&(a(this,m)?a(this,n).cancel({revert:!0}):a(this,n).cancelRetry()),this.scheduleGc()),a(this,u).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||d(this,c,f).call(this,{type:"invalidate"})}fetch(t,e){var A,w,x;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(e!=null&&e.cancelRefetch))this.cancel({silent:!0});else if(a(this,n))return a(this,n).continueRetry(),a(this,n).promise}if(t&&this.setOptions(t),!this.options.queryFn){const r=this.observers.find(o=>o.options.queryFn);r&&this.setOptions(r.options)}const s=new AbortController,h=r=>{Object.defineProperty(r,"signal",{enumerable:!0,get:()=>(l(this,m,!0),s.signal)})},G=()=>{const r=T(this.options,e),o={queryKey:this.queryKey,meta:this.meta};return h(o),l(this,m,!1),this.options.persister?this.options.persister(r,o,this):r(o)},p={fetchOptions:e,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:G};h(p),(A=this.options.behavior)==null||A.onFetch(p,this),l(this,g,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((w=p.fetchOptions)==null?void 0:w.meta))&&d(this,c,f).call(this,{type:"fetch",meta:(x=p.fetchOptions)==null?void 0:x.meta});const q=r=>{var o,S,b,F;U(r)&&r.silent||d(this,c,f).call(this,{type:"error",error:r}),U(r)||((S=(o=a(this,u).config).onError)==null||S.call(o,r,this),(F=(b=a(this,u).config).onSettled)==null||F.call(b,this.state.data,r,this)),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1};return l(this,n,H({initialPromise:e==null?void 0:e.initialPromise,fn:p.fetchFn,abort:s.abort.bind(s),onSuccess:r=>{var o,S,b,F;if(r===void 0){q(new Error(`${this.queryHash} data is undefined`));return}this.setData(r),(S=(o=a(this,u).config).onSuccess)==null||S.call(o,r,this),(F=(b=a(this,u).config).onSettled)==null||F.call(b,r,this.state.error,this),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1},onError:q,onFail:(r,o)=>{d(this,c,f).call(this,{type:"failed",failureCount:r,error:o})},onPause:()=>{d(this,c,f).call(this,{type:"pause"})},onContinue:()=>{d(this,c,f).call(this,{type:"continue"})},retry:p.options.retry,retryDelay:p.options.retryDelay,networkMode:p.options.networkMode,canRun:()=>!0})),a(this,n).start()}},v=new WeakMap,g=new WeakMap,u=new WeakMap,n=new WeakMap,C=new WeakMap,m=new WeakMap,c=new WeakSet,f=function(t){const e=s=>{switch(t.type){case"failed":return{...s,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,...J(s.data,this.options),fetchMeta:t.meta??null};case"success":return{...s,data:t.data,dataUpdateCount:s.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const h=t.error;return U(h)&&h.revert&&a(this,g)?{...a(this,g),fetchStatus:"idle"}:{...s,error:h,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:h,fetchStatus:"idle",status:"error"};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...t.state}}};this.state=e(this.state),Q.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate()}),a(this,u).notify({query:this,type:"updated",action:t})})},M);function J(i,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:k(t.networkMode)?"fetching":"paused",...i===void 0&&{error:null,status:"pending"}}}function W(i){const t=typeof i.initialData=="function"?i.initialData():i.initialData,e=t!==void 0,s=e?typeof i.initialDataUpdatedAt=="function"?i.initialDataUpdatedAt():i.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:e?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:e?"success":"pending",fetchStatus:"idle"}}function D(i){const t=`${i.collection}/${i.filename}`,[e,s]=E.useState(D.cache.get(t));return E.useEffect(()=>{L($(B,t)).then(h=>{D.cache.set(t,h),s(h)})},[t]),e?I.jsx("img",{...i,src:e}):I.jsx(z,{size:"lg"})}D.cache=new Map;export{Z as Q,D as S,J as f};
